
```
# 4.기술통계
# 1) 빈도표 출력
# 빈도분포는 한 변수에 대한 다양한 정보를 살펴볼 수 있는 가장 기본적인 분석방법이다. 빈도분포를 알아보기 위해서는 R에서 다양한 방법을 제공!!



# (1) table 함수를 이용한 빈도표 출력 #page97
# 빈도표를 구하기 위해서 가장 기본적인 명령어는 table임. table 명령어는 한 변수에 대해서 사용할 때는 기본적인 빈도분포를 제공하고, 두 변수에 대해서 사용할 때는 기본적인 교차표를제공.

# table 함수를 이용한 방법
table(test$EDU)
# 백분율의 정보는 제공하지 않음

# 빈도분포를 변수값이 아래쪽을 분포하도록 빈도분포를 구하기 위해서는 사용할 수 있는 ㅂ명령어가 ‘plry’패키지의 count 함수임. count 함수에는 빈도표를 출력하고자 하는 변수가 있는 데이터명을 먼저 입력하고, 다음에 해당 변수명을 입력. 해당 변수명을 입력할때는 작은 따옴표를 붙임.
# (2) ‘plyr’ 패키지를 이용한 빈도표 출력 #page98
# 'plyr'패키지를 이용하는 방법
# install.packages("plyr")
library(plyr)
count(test, 'EDU')

# 한 변수에 대한 대푯값(평균, 중앙치, 최빈치)이나 분산, 표준편차 등의 기술통계량은 ‘psych’, ‘Hmisc’ 같은 패키지의 함수를 이용하여 산출할 수 있다. ‘psych’와 ‘Hmisc’ 패키지의 describe 함수는 기술통계량을 산출하려는 변수를 지정하여 다양한 기술통계값을 얻을 수 있음.

# summary 함수를 이용한 기술통계량 출력, 가장 기본적으로 변수의 기술통계량을 알아볼수 있는 함수는 기본 패키지의 summary 함수임. summary 함수의 괄호안에 해당 변수명을 입력하면 그 변수의가장 기본적인 기술통계량이 출력됨. 만약 괄호안에 데이터 프레임명을 입력하면 데이터 프레임에 들어있는 모든 변수의 기술 통계량을 출력해 준다.
대표갓을 중심으로 최소한의 기본적인 내용(최소값, 1사분위값, 중앙값, 평균, 3사분위값, 최대값)만을 보여주기 때문에 좀 더 자세한 기술통계량을 구하기  위해서는 다음에서 소개하는 다양한 패키지에 들어있는 함수를 사용하는 것이 좋음.
# 2) 기술통계량 출력
# (1) summary 함수를 이용한 기술통계량 출력 #page100
summary(test$EDU)


# 앞에서 소개했던 summary 함수보다 좀 더 다양한 기술통계량을 구하고자 할 때 ‘psych’패키지의 describe 함수를 사용할 수 있음. 이 함수는 ‘Hmisc’패키지의 describe’ 함수와 이름은 동일하지만 다른 결과를 출력. ‘Hmisc’패키지의 describe 함수가 빈도표를 위주로 결과를 출력해 주는 반면, ‘psych’패키지의 describe 함수는 빈도표는 보여주지 않지만 다양한 기술통계량을 출력해 준다.


# (2) ‘psych’패키지를 이용한 기술통계량 출력 #page101
install.packages("psych")
library(psych)
describe(test$EDU)
# 위 결과에서 출력되는 기술통계량은 변수의 수(vars), 유효사례수(n), 평균(mean), 표준편처(sd), 중위수(median),  절사평균(trimmed mean), 디폴트 0, 1), 중위수 절대편차(mad: median absolute deviation, 각 사례값이 중위수로부터 떨어진 거리인 절대편차의 평균), 최소값(min), 최대값(max), 범위(range), 왜도(skew), 첨도(kurtosis), 표준오차(se: seandard error)가 제시.

# install.packages("Hmisc")
# library(Hmisc)
# describe(test$EDU)



# 교차분석(카이제곱 검증)이란 검중하고자 하는 변수가 모두 범주형 변수(명목척도, 서열척도) 일 때, 두 변수 간 연고나성이 있는지 알아보는 분석방법.

# 5.교차분석
# 교차분석을 좀더 쉽게 이해하도록 하기 위해서 아래와 같이 가설을 설정한 뒤 분석 데이터를 통해 가설을 검증하는 과정을 거치면서 교차분석 방법을 설명함.
# 가설: (대립가설) 성별에 따라 전반적인 평화의 분포가 다를 것이다.
# (1) table 함수를 이용한 교차분석: ① 평화 변수값을 새 변수명으로 재부호화 한다. 재부호화한 새 변수의 변수값 설명을 입력한다. ② 두 변수의 값에 따른 사례수를 계산한다. ③ 두 변수의 값에 따른 주변 합계를 계산한다. 두 변수의 값에 따른 비율을 계산한다. 카이제곱(X2) 값을 계산한다.

# 1) 교차분석의 분석 방법
# ① Peace 속성을 ‘낮음’, ‘보통’, ‘높음’ 응답으로 재부호화 #page102
# 앞 장에서 ‘새 변수 만들기’를 통해 해당 변수를 만들어 놓았다.
# attach(test)
# test$grp.Peace[Peace >= min(Peace) & Peace <= 3.2] <- 1
# test$grp.Peace[Peace >= 3.3 & Peace <= 3.8] <- 2
# test$grp.Peace[Peace >= 3.9 & Peace <= max(Peace)] <- 3
# detach(test)

# table 함수를 이용해서 대립가설에서 검증할 변수(~)를 순서대로 지정하고, 이 결과를 devi02_1.re라는 객체에 저장. 객체의 이름을 입력하여 결과를 출력.
# ② 두 변수의 값에 따른 사례수 출력 #page103
devi02_1.re <- table(test$grp.Peace, test$Gender)
devi02_1.re
# 교차표의 결과를 출력하면 가로축은 성별(1 ‘남자’, 2 ‘여자’), 세로축은 전반적인 평화(1 ‘평화가 낮은 편’, 2 ‘평화가 보통’, 3 ‘평화가 높은 편’)가 출력됨. table 함수를 이용하여 교차표를 만들면 해당 변수의 변수값 설명이 출력되지 않고, 변수값만이 출력.

# 만일 변수값 대신 변수값 설명을 출력하고 싶다면 변수값을 변수값 설명으로 대체하면 됨.
# attach 함수를 이용하여 기존에 재부호화 한 변수인 grp.Peace 변수에서 1번을 "1_평화 낮음", 2번을 "2_평화 보통", 3번을 "3_평화 높음"으로 다시 재부호화 하면 됨. 
# 참고 - 변수값을 변수값 설명으로 대체 #p105
attach(test)
test$grp.Peace_1[grp.Peace==1] <- "1_평화 낮음"
test$grp.Peace_1[grp.Peace==2] <- "2_평화 보통"
test$grp.Peace_1[grp.Peace==3] <- "3_평화 높음"
test$Gender_1[Gender==1] <- "1_남자"
test$Gender_1[Gender==2] <- "2_여자"
detach(test)

# 변수값을 변수값 설명으로 대체한 변수로 교차표 출력
devi02.re<- table(test$grp.Peace_1, test$Gender_1)
devi02.re

# ③ 두 변수의 값에 따른 주변합계를 출력
margin.table(devi02.re)      # grp.Peace_1과 Gender_1 변수의 전체합계
margin.table(devi02.re, 1)   # grp.Peace_1 변수의 주변 합계
margin.table(devi02.re, 2)   # Gender_1 변수의 주변 합계


# ‘gmodels’ 패키지를 이용하여 교차표를 작성하고, 값을 통해 가설을 검증한다.
# ‘gmodels’ 패키지의 CrossTable 함수에 전반적인 평화와 성별 변수를 입력, 소수점 자리수는 2자리로 지정(digits=2)하고, 열의 비율과 값을 출력하도록 함.(prop.c=TRUE, chisq=TRUE)
# 행의 비율, 전체 사례수 대비 비율, 그리고 전체 값 대비 셀별 x값의 비율은 출력하지 않도록 지정(prop.r=FALSE, prop.t=FALSE, prop.c=FALSE)
# (2) ‘gmodels’ 패키지를 이용한 교차분석 #page106
# install.packages("gmodels")
library(gmodels)
CrossTable(test$grp.Peace_1, test$Gender_1, digits=2,
           prop.c=TRUE, prop.r=FALSE, prop.t=FALSE, prop.chisq=FALSE,
           chisq=TRUE)
# 결과에서 p값이 0.0005396821로 신뢰도 95%(0.05) 보다 작기 때문에 귀무가설을 기각되고, 성별에 따라 전반적인 평화의 분포가 다르다는 대립가설이 채택.


# 독립표본 T검정의 분석방법: 독립표본 T검정이란 독립적인 두 집단의 평균차이를 검정하기 위한 분석이다. 독립표본 T 검증을 위해서는 다음과 같은 가설을 설정하고 가설을 검정하는 과정을 따라서 독립표본 T 검증 방법을 살펴보기로 함.
# 가설: (대립가설) 대한민국 성인 남녀 두 집단의 평균 행복지수는 다를 것이다.
# ① 남녀에 대한 행복변수를 만든다. ②분산 동질성을 검증한다. ③ 대립가설을 검증한다. ④ 집단에 따른 기술통계량을 출력한다. 집단에 따른 평균 비교를 위해 도표를 출력한다.


# 6. T검정
# 1) 독립표본 T 검정의 분석 방법
# ① 행복에 대한 변수를 만들기 #page109
attach(test)
test <- transform(test, Happiness = (Q11 + Q12 + Q13 + Q14 + Q15) / 5)
detach(test)
# attach 함수를 이용하여 5개 행복 관련 변수들의 평균값을 새 변수()에 저장하고, detach 함수로 행복 변수 만들기를 종료함.

# ② 분산 동질성 검증 
var.test(Happiness ~ Gender, data=test)
# T검증에 사용할 변수의 구성이 마무리 되면, 본격적인 T검증을 시행하기 전에 집단간의 분산이 동일한지 여부에 대해서 검증해야 한다. 등분산 검증의 (귀무가설)은 ‘두 집단의 분산은 같다’ 이고, (대립가설)은 ‘두 집단의 분산은 같지 않다’이다. 등분산 검증은 var.test 함수를 이용한다. var.test 함수에는 종속변수를 먼저 입력하고 그 다음에 독립변수를 입력한다. 그리고 종속변수와 독립변수 사이에는 ‘~’ 기호를 입력한다. 데이터를 별도로 지정하기 때문에 변수명만 입력하면 된다. var.test 함수에 사용하는 변수가 있는 데이터를 지정한다(data=test)
# p-value가 0.5715로 신뢰도 기준인 0.05보다 크기 때문에 귀무가설이 채택, 따라서, 두 집단의 분산이 같다는 가정으로 T검증을 수행해야 함.



# ③ 대립(연구)가설 검증 #page110
t.test(Happiness ~ Gender, var.equal=TRUE, data=test)
# t.test 함수를 이용하여 T 검증을 수행. T 검증은 var.test 함수에서와 같이 종속변수와 독립변수의 순서로 입력하고, 그 사이에 ‘~’ 기호를 입력한다. 집단의 등분산 여부를 의미하는 var.equal 인자에는 앞서 등분산 검증의 결과에서 두 집단의 분산이 같다고 가정할 수 있으므로 TRUE를 입력하고(var.equal=TRUE), 종속변수와 독립변수가 포함된 데이터를 입력한다.
# T검증 결과를 보면 p-value가 0.177로 유의도 0.05보다 크기 때문에 (대립가설) 대한민국 성인 남녀 두 집단의 평균 행복지수는 다를 것이다.는 대립가설은 기각되고 성별에 따라 행복의 차이가 없다는 귀무가설이 채택된다.



# 위의 결과를 통해 1차적으로 T검증에 대한 유의도 분석은 끝났다. 다음으로 남녀 집단의 특성을 구체적으로 살펴보기 위해서 독립변수인 성별 변수의 속성에 따른 다양한 기술통계량을 살펴보도록 한다. ‘psych’ 패키지의 describeBY 함수를 이용해 집단에 따른 기술통계량을 출력하기 위해 함수 다음에 종속변수와 독립변수의 순서로 입력하여 결과를 출력한다. 분석 결과 사례수, 평균, 표준편차 등 다양한 기술통계량이 출력된다. T 검증의 결과와 함께 기술통계에서 출력되는 다양한 통계량으로 최종적으로 제시할 표를 작성하면 됨.
# ④ 집단에 따른 기술통계량 #page111
library(psych)
describeBy(test$Happiness, test$Gender)




















# 상관분석이란 서로 관련된다고 예측되는 두 연속형 변수(구간척도, 비율척도)들 간에 얼마나 연관성이 있는지 알아보는 분석임. 단순상관분석의 방법에서 먼저 두 변수 간의 단순상관관계를 검증하기 위해 다음과 같은 가설을 설정한다. (대립가설) 건강한 몸의 느낌과 행복 간에는 관계가 있을 것이다.

# 상관관계를 분석하는 방법을 2가지로 소개함. 첫 번째는 기본 패키지에 있는 cor 함수를 사용하는 방법, 두 번째는 ‘psych’ 패키지를 사용해서 분석하는 방법.


# 8.상관분석
# 단순상관분석의 분석 방법
# ① 상관 분석을 위한 독립변수와 종속변수를 만든다. ② cor 함수를 이용해서 상관분석을 수행한다. ③ 두 변수간 상관계수와 유의도를 출력한다. 
# (1) cor 함수를 이용한 상관분석 
# ① 변수 만들기 #page130
# ‘건강한 몸의 느낌’ 변수
test$BF <- (test$Q1 + test$Q2 + test$Q3 + test$Q4 + test$Q5) / 5
# ‘건강한 자기관리’ 변수 
attach(test)
test$BM <- (Q6 + Q7 + Q8 + Q9 + Q10) / 5
detach(test)
# ‘행복’ 변수
attach(test)
test <- transform(test, Happiness = (Q11 + Q12 + Q13 + Q14 + Q15) / 5)
detach(test)
# ‘평화’ 변수
attach(test)
test$Peace <- (Q16 + Q17 + Q18 + Q19 + Q20) / 5
detach(test)


# ② cor 함수를 이용한 상관분석 #page131
cor(test[c("BM","BF","Happiness","Peace")], use="pairwise.complete.obs") 
# use: 데이터의 결측값 처리를 위한 인자(all.ops: 데이터에 결측값이 없음, complete.obs:listwise와 같이 분석대상인 변수에서 결측값이 있는 사례는 모두 제외하여 분석, pairwise.complete.obs: 상관분석의 두 변수 중에서 결측값이 있는 사례만 제외하여 분석)




# 앞의 명령어에서는 cor 함수에 분석하려는 데이터명과 변수명을 모두 기록하였는데, 이 변수명들을 자주 분석에 사용한다면 해당 변수만으로 구성한 객체를 만들면 나중에 편리하게 사용할 수 있음.(분석하고자 하는 변수만을 지정하여 따로 객체로 만들어 cor 함수에 지정) 또한 앞의 [분석 결과]에서 소수점 자리수가 너무 길게 나와서 보기에 불편함이 있기 때문에 소수점 자리수를 다음과 같이 조정 가능.
# 출력된 상관계수의 소수점 자리를 조정하기 위해 round 함수를 이용할 수 있음. round 함수에 cor 함수를 사용한 스크립트를 입력하고, 소수점 둘째 자리까지 출력하기 위해 2를 인자로 입력함.
# 분석하려는 변수만을 객체로 만들어 분석하는 방법 #page132
cor.var <- test[c("BM", "BF", "Happiness", "Peace")]
cor(cor.var, use = "pairwise.complete.obs")
# 상관계수의 소수점 자리수 조정 
round(cor(test[c("BM","BF","Happiness","Peace")], use="pairwise.complete.obs"), 2)



# p-value가 0.05보다 작기 때문에 귀무가설은 기각되고 대립가설이 채택
# ③ 두 변수 간의 상관계수와 유의도 출력 #page133
cor.test(test$BM, test$Happiness)


```